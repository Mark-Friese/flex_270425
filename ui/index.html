<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flexibility Analysis System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Leaflet CSS for maps -->
    <link href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <header class="bg-dark text-white p-3 d-flex justify-content-between align-items-center">
            <h1 class="h3 m-0">Flexibility Analysis System</h1>
            <div class="d-flex align-items-center">
                <div id="configStatus" class="me-3">
                    <span class="badge bg-warning">Config Not Loaded</span>
                </div>
                <div class="dropdown">
                    <button class="btn btn-outline-light dropdown-toggle" type="button" id="settingsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-cog"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="settingsDropdown">
                        <li><a class="dropdown-item" href="#" id="loadConfigBtn"><i class="fas fa-file-import me-2"></i>Load Configuration</a></li>
                        <li><a class="dropdown-item" href="#" id="outputDirBtn"><i class="fas fa-folder-open me-2"></i>Set Output Directory</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="viewLogsBtn"><i class="fas fa-list-alt me-2"></i>View Logs</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <div class="row mt-3">
            <!-- Sidebar -->
            <div class="col-md-3">
                <!-- Analysis Form -->
                <div class="card mb-3 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-bolt me-2"></i>Analysis Settings
                    </div>
                    <div class="card-body">
                        <form id="analysisForm">
                            <div class="mb-3">
                                <label for="substationSelect" class="form-label">Substation</label>
                                <select id="substationSelect" class="form-select" required disabled>
                                    <option value="">Select a substation...</option>
                                </select>
                                <div class="form-text">Select a substation to analyze</div>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="generateCompetitionsCheck" checked>
                                <label class="form-check-label" for="generateCompetitionsCheck">Generate Competitions</label>
                            </div>
                            
                            <div class="mb-3">
                                <label for="targetYearInput" class="form-label">Target Year (optional)</label>
                                <input type="number" class="form-control" id="targetYearInput" placeholder="e.g., 2025">
                                <div class="form-text">Year to use for competition dates</div>
                            </div>
                            
                            <button type="submit" id="runAnalysisBtn" class="btn btn-success w-100" disabled>
                                <i class="fas fa-play me-2"></i>Run Analysis
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Previous Results -->
                <div class="card mb-3 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-history me-2"></i>Previous Results
                    </div>
                    <div class="card-body">
                        <div id="previousResultsList">
                            <p class="text-center text-muted">No results available</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9">
                <!-- Status Panel -->
                <div class="card mb-3 shadow-sm">
                    <div class="card-body p-2">
                        <div id="statusArea" class="alert alert-secondary mb-0">
                            Ready to start. Please load a configuration file.
                        </div>
                        <div class="progress mt-2 d-none" id="progressBar">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Tabs -->
                <div class="card shadow">
                    <div class="card-header bg-light">
                        <ul class="nav nav-tabs card-header-tabs" id="resultsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab">
                                    <i class="fas fa-chart-line me-1"></i>Summary
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="plots-tab" data-bs-toggle="tab" data-bs-target="#plots" type="button" role="tab">
                                    <i class="fas fa-chart-area me-1"></i>Plots
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="competitions-tab" data-bs-toggle="tab" data-bs-target="#competitions" type="button" role="tab">
                                    <i class="fas fa-trophy me-1"></i>Competitions
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="map-tab" data-bs-toggle="tab" data-bs-target="#map" type="button" role="tab">
                                    <i class="fas fa-map-marked-alt me-1"></i>Map
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="resultsTabContent">
                            <!-- Summary Tab -->
                            <div class="tab-pane fade show active" id="summary" role="tabpanel">
                                <div id="summaryContent">
                                    <div class="alert alert-info" id="noResultsMessage">
                                        <i class="fas fa-info-circle me-2"></i>No analysis results to display. Please run an analysis first.
                                    </div>
                                    <div id="resultsArea" class="d-none">
                                        <h4 id="summaryTitle" class="mb-3">Results Summary</h4>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="card mb-3 bg-light">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Firm Capacity</h5>
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Standard E(C)</h6>
                                                                    <div class="h3" id="metricCPlain">-</div>
                                                                    <small>MW</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2 border-primary bg-primary bg-opacity-10">
                                                                    <h6>Peak-based E(C)</h6>
                                                                    <div class="h3" id="metricCPeak">-</div>
                                                                    <small>MW</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card mb-3 bg-light">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Demand Statistics</h5>
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Mean Demand</h6>
                                                                    <div class="h3" id="metricMeanDemand">-</div>
                                                                    <small>MW</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Max Demand</h6>
                                                                    <div class="h3" id="metricMaxDemand">-</div>
                                                                    <small>MW</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="card mb-3 bg-light">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Energy</h5>
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Total Energy</h6>
                                                                    <div class="h3" id="metricTotalEnergy">-</div>
                                                                    <small>MWh</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Energy Above Capacity</h6>
                                                                    <div class="h3" id="metricEnergyAbove">-</div>
                                                                    <small>MWh</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card mb-3 bg-light">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Competition Info</h5>
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Target</h6>
                                                                    <div class="h3" id="metricTarget">-</div>
                                                                    <small>MWh</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="metric-card text-center p-3 border rounded mb-2">
                                                                    <h6>Competitions</h6>
                                                                    <div class="h3" id="metricCompetitions">-</div>
                                                                    <small>Count</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="table-responsive mt-3">
                                            <table class="table table-striped table-hover" id="summaryTable">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th>Metric</th>
                                                        <th>Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Plots Tab -->
                            <div class="tab-pane fade" id="plots" role="tabpanel">
                                <div id="plotsContainer" class="text-center">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>No plots available. Please run an analysis first.
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Competitions Tab -->
                            <div class="tab-pane fade" id="competitions" role="tabpanel">
                                <div id="competitionsContainer">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>No competitions available. Please run an analysis with "Generate Competitions" enabled.
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Map Tab -->
                            <div class="tab-pane fade" id="map" role="tabpanel">
                                <div id="mapContainer" style="height: 500px">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>No map data available.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="bg-light text-center p-3 mt-3">
            <div class="small text-muted">Flexibility Analysis System &copy; 2025</div>
        </footer>
    </div>
    
    <!-- Modal for Logs -->
    <div class="modal fade" id="logsModal" tabindex="-1" aria-labelledby="logsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logsModalLabel">Application Logs</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <pre id="logsContent" class="bg-dark text-light p-3" style="max-height: 400px; overflow-y: auto;"></pre>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="js/app.js"></script>
</body>
</html>
